'use strict';

// Minified sww.js
!function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[a]={exports:{}};t[a][0].call(h.exports,function(e){var r=t[a][1][e];return o(r?r:e)},h,h.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e){var t=e("./lib/sww.js");self.ServiceWorkerWare=t.ServiceWorkerWare,self.StaticCacher=t.StaticCacher,self.SimpleOfflineCache=t.SimpleOfflineCache},{"./lib/sww.js":5}],2:[function(e,t){"use strict";function r(e){this.options=e,this.stack=[]}r.prototype.ALL_METHODS="all",r.prototype.methods=["get","post","put","delete","head",r.prototype.ALL_METHODS],r.prototype.add=function(e,t,r){var n,o,i;e=this._sanitizeMethod(e),n=this._parseSimplePath(t),o=n.regexp,i=n.tags,this.stack.push({method:e,path:o,namedPlaceholders:i,handler:r})},r.prototype.methods.forEach(function(e){r.prototype[e]=function(t,r){return this.add(e,t,r)}}),r.prototype.proxyMethods=function(e){var t=this;this.methods.forEach(function(r){e[r]=function(e,n){if("function"!=typeof n.onFetch&&"function"!=typeof n)throw new Error("This middleware cannot handle fetch request");var o="undefined"!=typeof n.onFetch?n.onFetch.bind(n):n;t.add(r,e,o)}})},r.prototype.match=function(e,t){e=this._sanitizeMethod(e);var r=[],n=this;return this.stack.forEach(function(o){if(e===o.method||o.method===n.ALL_METHODS){var i=n._routeMatch(t,o);i&&(o.handler.__params=i,r.push(o.handler))}}),r},r.prototype._routeMatch=function(e,t){var r=e.match(t.path);return r?this._mapParameters(r,t.namedPlaceholders):null},r.prototype._mapParameters=function(e,t){return t.reduce(function(t,r,n){return t[r]=e[n+1],t},Object.create(null))},r.prototype._sanitizeMethod=function(e){var t=e.toLowerCase().trim();if(-1===this.methods.indexOf(t))throw new Error('Method "'+e+'" is not supported');return t},r.prototype._parseSimplePath=function(e){if(/\:[a-zA-Z0-9]+\:[a-zA-Z0-9]+/g.test(e))throw new Error("Invalid usage of named placeholders");var t=/(\*\:[a-zA-Z0-9]+)|(\:[a-zA-Z0-9]+\:[a-zA-Z0-9]+)|(\:[a-zA-Z0-9]+\*)/g;if(t.test(e.replace(/\\\*/g,"")))throw new Error("Invalid usage of named placeholders");try{e=e.replace(/(.|^)[*]+/g,function(e,t){return"\\"===t?"\\*":t+"(?:.*?)"});var r=[];return e=e.replace(/(.|^)\:([a-zA-Z0-9]+)/g,function(e,t,n){return"\\"===t?":"+n:(r.push(n),t+"(.+?)")}),{regexp:RegExp(e+"$"),tags:r}}catch(n){throw new Error("Invalid path specified")}},t.exports=r},{}],3:[function(e,t){"use strict";function r(e,t,r){this.cacheName=e||s,this.options=t||o,this.missPolicy=r||i,-1===a.indexOf(this.missPolicy)&&(console.warn("Policy "+r+" not supported"),this.missPolicy=i)}var n=function(){},o={ignoreSearch:!1,ignoreMethod:!1,ignoreVary:!1},i="fetch",a=[i],s="offline";r.prototype.onFetch=function(e,t){if(t)return Promise.resolve(t);var r=e.clone(),o=this;return n("Handing fetch event: "+r.url),this.ensureCache().then(function(t){return t.match(r,o.options).then(function(t){if(t)return t;switch(o.missPolicy){case i:return fetch(e)}})})},r.prototype.ensureCache=function(){return this.cacheRequest||(this.cacheRequest=caches.open(this.cacheName)),this.cacheRequest},t.exports=r},{}],4:[function(e,t){"use strict";function r(e){if(!Array.isArray(e)||0===e.length)throw new Error("Invalid file list");this.files=e}r.prototype.onInstall=function(){var e=this;return this.getDefaultCache().then(function(t){return e.addAll(t,e.files)})},r.prototype.getDefaultCache=function(){return this.cacheRequest||(this.cacheRequest=caches.open("offline")),this.cacheRequest},r.prototype.addAll=function(e,t){if(!e)throw new Error("Need a cache to store things");if("undefined"!=typeof e.addAll)return e.addAll(t);var r=[],n=this;return t.forEach(function(t){r.push(n.fetchAndCache(new Request(t),e))}),Promise.all(r)},r.prototype.fetchAndCache=function(e,t){return fetch(e.clone()).then(function(r){return parseInt(r.status)<400&&t.put(e.clone(),r.clone()),r})},t.exports=r},{}],5:[function(e,t){"use strict";function r(e){return fetch(e)}function n(e){e=e||{},("function"==typeof e||e.onFetch)&&(e={fallbackMiddleware:e}),e.autoClaim="autoClaim"in e?e.autoClaim:!0,this.middleware=[],this.router=new s({}),this.router.proxyMethods(this),this.fallbackMw=e.fallbackMiddleware||r,this.autoClaim=e.autoClaim}var o=function(){},i=e("./staticcacher.js"),a=e("./simpleofflinecache.js"),s=e("./router.js"),c="error",u="continue",h="terminate",f={};n.prototype.init=function(){addEventListener("install",this),addEventListener("activate",this),addEventListener("beforeevicted",this),addEventListener("evicted",this),addEventListener("fetch",this),addEventListener("message",this)},n.prototype.handleEvent=function(e){switch(o("Event received: "+e.type),e.type){case"install":this.onInstall(e);break;case"fetch":this.onFetch(e);break;case"activate":this.onActivate(e);break;case"message":case"beforeevicted":case"evicted":this.forwardEvent(e);break;default:o("Unhandled event "+e.type)}},n.prototype.onFetch=function(e){var t=this.router.match(e.request.method,e.request.url);t.push(function(e,t){return t?Promise.resolve(t):this.fallbackMw(e,t)}.bind(this)),e.respondWith(this.executeMiddleware(t,e.request))},n.prototype.executeMiddleware=function(e,t){var r=this.runMiddleware(e,0,t,null);return r["catch"](function(e){console.error(e)}),r},n.prototype.runMiddleware=function(e,t,r,o){if(t>=e.length)return Promise.resolve(o);var i=e[t];r&&(r.parameters=i.__params);var a=n.endWith,s=i(r,o,a),f=n.normalizeMwAnswer(s,r,o);return f.then(function(r){switch(r.nextAction){case h:return Promise.resolve(r.response);case c:return Promise.reject(r.error);case u:var n=t+1,o=r.request,i=r.response;return this.runMiddleware(e,n,o,i)}}.bind(this))},n.endWith=function(e){if(0===arguments.length)throw new Error("Type error: endWith() must be called with a value.");return[f,e]},n.normalizeMwAnswer=function(e,t,r){return e&&e.then||(e=Promise.resolve(e)),e.then(function(e){var n,o,i,a=u,s=Array.isArray(e);if(s&&e[0]===f)a=h,o=t,i=e[1]||r;else if(null===e)o=t,i=null;else if(s&&2===e.length)o=e[0],i=e[1];else if(e instanceof Response)o=t,i=e;else if(e instanceof Request)o=e,i=r;else{var l="Type error: middleware must return a Response, a Request, a pair [Response, Request] or a Promise resolving to one of these types.";a=c,n=new Error(l)}return{nextAction:a,request:o,response:i,error:n}})},n.prototype.onInstall=function(e){var t=this.getFromMiddleware("onInstall");e.waitUntil(t)},n.prototype.onActivate=function(e){var t=this.getFromMiddleware("onActivate");this.autoClaim&&(t=t.then(function(){return self.clients.claim()})),e.waitUntil(t)},n.prototype.getFromMiddleware=function(e){var t=this.middleware.reduce(function(t,r){return"function"==typeof r[e]&&t.push(r[e]()),t},[]);return Promise.all(t)},n.prototype.use=function(){if(0===arguments.length)throw new Error("No arguments given");var e=arguments[0],t="*",r=this.router.ALL_METHODS;if("string"==typeof e){t=arguments[0],e=arguments[1];var n=typeof e;if(!e||"object"!==n&&"function"!==n)throw new Error("No middleware specified");-1!==s.prototype.methods.indexOf(arguments[2])&&(r=arguments[2])}this.middleware.push(e);var o=null;"function"==typeof e.onFetch?o=e.onFetch.bind(e):"function"==typeof e&&(o=e),o&&this.router.add(r,t,o),"function"==typeof e.onMessage&&(e.broadcastMessage=this.broadcastMessage)},n.prototype.forwardEvent=function(e){this.middleware.forEach(function(t){var r="on"+e.type.replace(/^[a-z]/,function(e){return e.toUpperCase()});"undefined"!=typeof t[r]&&t[r].call(t,e)})},n.prototype.broadcastMessage=function(e,t){if("function"==typeof BroadcastChannel){var r=new BroadcastChannel(t);return r.postMessage(e),r.close(),Promise.resolve()}return clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e)})})},n.decorators={ifNoResponse:function(e){return function(t,r,n){return r?[t,r]:e(t,r,n)}},stopAfter:function(e){return function(t,r,o){var i=e(t,r,o),a=n.normalizeMwAnswer(i,t,r);return a.then(function(e){return"error"===e.nextAction?Promise.reject(e.error):o(e.response)})}}},t.exports={ServiceWorkerWare:n,StaticCacher:i,SimpleOfflineCache:a}},{"./router.js":2,"./simpleofflinecache.js":3,"./staticcacher.js":4}]},{},[1]);
// End minified sww.js

const worker = new self.ServiceWorkerWare();

worker.use(new self.StaticCacher(['index.html', 'js/app.js', 'payload.json']));
worker.use(new self.SimpleOfflineCache());

worker.init();

console.log('SW ready to serve');
